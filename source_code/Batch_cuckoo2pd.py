#author: Rushaan Kamran
import pathlib
import json
import csv
import pandas as pd
from pprint import pprint
from pandas.io.json import json_normalize
for n in range(1,200,1):
	#Format example /home/.cuckoo/storage/analyses/1/reports/reports.json 
	path = "/PATH/TO/CUCKOO/REPORTS/"+str(n)+"/reports/report.json"
	if (not pathlib.Path(path).exists()):
		continue
	data = json.load(open(path))
	json_str = json.dumps(data)
	data = json.loads(json_str)
	calls_list=[]
	
	print("File ID:"+str((data['info']['id'])))
	print("Filename:"+str(data['target']['file']['name']))
	print("md5:"+str(data['target']['file']['md5']))
	print("File size:"+str(data['target']['file']['size']))
	
	try:
		print("Number of processes created:"+str(len((data['behavior']['processes']))))
		for i in range(1,len((data['behavior']['processes']))):
			#print(data['behavior']['processes'][i]['calls'])
			calls=(data['behavior']['processes'][i]['calls'])
			calls_list.append(json_normalize(calls))
			print(len(calls_list))
		all_calls=pd.concat(calls_list)
		nm=str((data['target']['file']['name']))
		all_calls.to_csv(('calls_'+str(nm)+'.csv'),mode='w',columns=['api'],index=False)
		print("Created calls"+str(nm)+".csv")
	except Exception as e:
		print("exception",e)
		print('Skipped file: '+path)
